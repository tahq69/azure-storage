// Azure Storage JavaScript Client Library 0.2.6-preview.12 
// Copyright (c) Microsoft and contributors. All rights reserved. 
require=function e(t,r,n){function s(a,i){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!i&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return s(r||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({2:[function(e,t,r){var n=window.AzureStorage||{};n.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var s=e("../lib/services/file/fileservice.browser");n.FileService=s,n.FileUtilities=e("../lib/services/file/fileutilities"),n.createFileService=function(e,t,r){return new s(e,t,r)},n.createFileServiceWithSas=function(e,t){return new s(null,null,e,t)};var o=e("../lib/common/common.browser"),a=o.StorageServiceClient,i=o.SharedKey;n.generateAccountSharedAccessSignature=function(e,t,r){var n=a.getStorageSettings(e,t);return new i(n._name,n._key).generateAccountSignedQueryString(r)},n.Constants=o.Constants,n.StorageUtilities=o.StorageUtilities,n.AccessCondition=o.AccessCondition,n.SR=o.SR,n.StorageServiceClient=a,n.Logger=o.Logger,n.WebResource=o.WebResource,n.Validate=o.validate,n.date=o.date,n.LinearRetryPolicyFilter=o.LinearRetryPolicyFilter,n.ExponentialRetryPolicyFilter=o.ExponentialRetryPolicyFilter,n.RetryPolicyFilter=o.RetryPolicyFilter,window.AzureStorage=n},{"../lib/common/common.browser":5,"../lib/services/file/fileservice.browser":50,"../lib/services/file/fileutilities":52}],50:[function(e,t,r){var n=e("./fileservice.core"),s=e("./../../common/common.browser"),o=e("extend"),a=s.util,i=s.BrowserFileReadStream,l=s.SpeedSummary,u=s.validate,c=s.ChunkStreamWithStream;n.prototype.createFileFromBrowserFile=function(e,t,r,n,s,d){var p;a.normalizeArgs(s,d,function(e,t){p=e,d=t}),u.validateArgs("createFileFromBrowserFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.browserFileIsValid(n),s.shareNameIsValid(e),s.callback(d)});var h=o(!0,{},p);h.speedSummary=h.speedSummary||new l(r);var f=this;return this.createFile(e,t,r,n.size,h,function(s){if(s)d(s);else{var o=new i(n),a=new c(o,{calcContentMd5:h.storeFileContentMD5});f._createFileFromChunkStream(e,t,r,a,n.size,h,d)}}),h.speedSummary},t.exports=n},{"./../../common/common.browser":5,"./fileservice.core":51,extend:157}],51:[function(e,t,r){(function(r){function n(e,t,r,s,o){var a=S.getStorageSettings(e,t,r,s,o);n.super_.call(this,a._name,a._key,a._fileEndpoint,a._usePathStyleUri,a._sasToken),this.defaultEnableReuseSocket=R.DEFAULT_ENABLE_REUSE_SOCKET,this.singleFileThresholdInBytes=E.DEFAULT_SINGLE_FILE_GET_THRESHOLD_IN_BYTES,this.parallelOperationThreadCount=R.DEFAULT_PARALLEL_OPERATION_THREAD_COUNT}function s(e,t,r,n){var s=function(e){return e&&!n&&(e=(e=(e=(e=encodeURIComponent(e)).replace(/%2F/g,"/")).replace(/%5C/g,"/")).replace(/\+/g,"%20")),e},o=e;return t&&("/"!==t[0]&&(o+="/"),o+=s(t)),r&&("/"!==o[o.length-1]&&(o+="/"),o+=s(r)),c.normalize(o).replace(/\\/g,"/")}var o=e("querystring"),a=e("url"),i=e("util"),l=e("underscore"),u=e("extend"),c=e("path"),d=e("./../../common/common.core"),p=e("./../../common/md5-wrapper"),h=d.util,f=d.SR,g=d.validate,m=d.SpeedSummary,S=d.StorageServiceClient,y=d.WebResource,R=d.Constants,E=R.FileConstants,v=R.HeaderConstants,A=R.HttpConstants,T=R.QueryStringConstants,I=d.BatchOperation,m=d.SpeedSummary,N=d.ChunkAllocator,_=d.ChunkStream,w=d.ChunkStreamWithStream,C=e("./internal/filerangestream"),O=e("./models/shareresult"),F=e("./models/directoryresult"),b=e("./models/fileresult"),P=d.AclResult,M=e("../../common/errors/errors"),H=M.ArgumentNullError,D=M.ArgumentError;i.inherits(n,S),n.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},n.prototype.setServiceProperties=function(e,t,r){return this.setAccountServiceProperties(e,t,r)},n.prototype.listSharesSegmented=function(e,t,r){this.listSharesSegmentedWithPrefix(null,e,t,r)},n.prototype.listSharesSegmentedWithPrefix=function(e,t,r,n){var s;h.normalizeArgs(r,n,function(e,t){s=e,n=t}),g.validateArgs("listShares",function(e){e.callback(n)});var o=u(!0,{},s),a=y.get().withQueryOption(T.COMP,"list").withQueryOption(T.MAX_RESULTS,o.maxResults).withQueryOption(T.INCLUDE,o.include);h.objectIsNull(t)||a.withQueryOption(T.MARKER,t.nextMarker),a.withQueryOption(T.PREFIX,e);this.performRequest(a,null,o,function(e,t){if(e.listSharesResult=null,!e.error){e.listSharesResult={entries:null,continuationToken:null},e.listSharesResult.entries=[];var r=[];e.response.body.EnumerationResults.Shares&&e.response.body.EnumerationResults.Shares.Share&&(r=e.response.body.EnumerationResults.Shares.Share,l.isArray(r)||(r=[r])),r.forEach(function(t){var r=O.parse(t);e.listSharesResult.entries.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listSharesResult.continuationToken={nextMarker:null,targetLocation:null},e.listSharesResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listSharesResult.continuationToken.targetLocation=e.targetLocation)}t(e,function(e){n(e.error,e.listSharesResult,e.response)})})},n.prototype.doesShareExist=function(e,t,r){this._doesShareExist(e,!1,t,r)},n.prototype.createShare=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("createShare",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.shareQuotaIsValid(n.quota),t.callback(r)});var s=u(!0,{},n),o=y.put(e).withQueryOption(T.RESTYPE,"share").withHeader(v.SHARE_QUOTA,s.quota);o.addOptionalMetadataHeaders(s.metadata);this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new O(e),t.shareResult.getPropertiesFromHeaders(t.response.headers),s.metadata&&(t.shareResult.metadata=s.metadata));n(t,function(e){r(e.error,e.shareResult,e.response)})})},n.prototype.createShareSnapshot=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("createShareSnapshot",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n),o=y.put(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,T.SNAPSHOT);o.addOptionalMetadataHeaders(s.metadata);this.performRequest(o,null,s,function(e,t){e.snapshotId=null,e.error||(e.snapshotId=e.response.headers[v.SNAPSHOT]);t(e,function(e){r(e.error,e.snapshotId,e.response)})})},n.prototype.createShareIfNotExists=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("createShareIfNotExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n);delete s.shareSnapshotId;var o=this;o._doesShareExist(e,!0,s,function(t,n,a){var i=n.exists;n.created=!1,delete n.exists,t?r(t,n,a):i?(a.isSuccessful=!0,r(t,n,a)):o.createShare(e,s,function(e,t,n){e?e&&e.statusCode===A.HttpResponseCodes.Conflict&&e.code===R.FileErrorCodeStrings.SHARE_ALREADY_EXISTS&&(e=null,n.isSuccessful=!0):t.created=!0,r(e,t,n)})})},n.prototype.getShareProperties=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("getShareProperties",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n),o=y.head(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.SHARE_SNAPSHOT,s.shareSnapshotId),a=this;this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new O(e),t.shareResult.metadata=a.parseMetadataHeaders(t.response.headers),t.shareResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){r(e.error,e.shareResult,e.response)})})},n.prototype.setShareProperties=function(e,t,r,n){var o;h.normalizeArgs(r,n,function(e,t){o=e,n=t}),g.validateArgs("setShareProperties",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.shareQuotaIsValid(o.quota),t.callback(n)});var a=u(!0,t,o),i=s(e),l=y.put(i).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,"properties").withHeader(v.SHARE_QUOTA,a.quota);b.setProperties(l,a);this.performRequest(l,null,a,function(t,r){t.shareResult=null,t.error||(t.shareResult=new O(e),t.shareResult.getPropertiesFromHeaders(t.response.headers));r(t,function(e){n(e.error,e.shareResult,e.response)})})},n.prototype.getShareStats=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("getShareStats",function(e){e.callback(r)});var o=u(!0,{},n),a=s(e),i=y.get(a).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,"stats");this.performRequest(i,null,o,function(t,n){t.shareResult=null,t.error||(t.shareResult=O.parse(t.response.body,e),t.shareResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){r(e.error,e.shareResult,e.response)})})},n.prototype.getShareMetadata=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("getShareMetadata",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n),o=y.head(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,"metadata").withQueryOption(T.SHARE_SNAPSHOT,s.shareSnapshotId),a=this;this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new O(e),t.shareResult.metadata=a.parseMetadataHeaders(t.response.headers),t.shareResult.getPropertiesFromHeaders(t.response.headers));n(t,function(e){r(e.error,e.shareResult,e.response)})})},n.prototype.setShareMetadata=function(e,t,r,n){var s;h.normalizeArgs(r,n,function(e,t){s=e,n=t}),g.validateArgs("setShareMetadata",function(r){r.string(e,"share"),r.object(t,"metadata"),r.shareNameIsValid(e),r.callback(n)});var o=u(!0,{},s),a=y.put(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,"metadata");a.addOptionalMetadataHeaders(t);this.performRequest(a,null,o,function(t,r){t.shareResult=null,t.error||(t.shareResult=new O(e),t.shareResult.getPropertiesFromHeaders(t.response.headers));r(t,function(e){n(e.error,e.shareResult,e.response)})})},n.prototype.getShareAcl=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("getShareAcl",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n),o=y.get(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,"acl");s.requestLocationMode=R.RequestLocationMode.PRIMARY_OR_SECONDARY;this.performRequest(o,null,s,function(t,n){t.shareResult=null,t.error||(t.shareResult=new O(e),t.shareResult.getPropertiesFromHeaders(t.response.headers),t.shareResult.signedIdentifiers=P.parse(t.response.body));n(t,function(e){r(e.error,e.shareResult,e.response)})})},n.prototype.setShareAcl=function(e,t,n,s){var o;h.normalizeArgs(n,s,function(e,t){o=e,s=t}),g.validateArgs("setShareAcl",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(s)});var a=u(!0,{},o),i=null;if(t){if(l.isArray(t))throw new TypeError(f.INVALID_SIGNED_IDENTIFIERS);i=P.serialize(t)}var c=y.put(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.COMP,"acl").withHeader(v.CONTENT_LENGTH,h.objectIsNull(i)?0:r.byteLength(i)).withBody(i);this.performRequest(c,c.body,a,function(r,n){r.shareResult=null,r.error||(r.shareResult=new O(e),r.shareResult.getPropertiesFromHeaders(r.response.headers),t&&(r.shareResult.signedIdentifiers=t));n(r,function(e){s(e.error,e.shareResult,e.response)})})},n.prototype.deleteShare=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("deleteShare",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n);if(!h.objectIsNull(s.shareSnapshotId)&&!h.objectIsNull(s.deleteSnapshots))throw new D("options",f.INVALID_DELETE_SNAPSHOT_OPTION);var o=y.del(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.SHARE_SNAPSHOT,s.shareSnapshotId).withHeader(v.DELETE_SNAPSHOT,s.deleteSnapshots);this.performRequest(o,null,s,function(e,t){t(e,function(e){r(e.error,e.response)})})},n.prototype.deleteShareIfExists=function(e,t,r){var n;h.normalizeArgs(t,r,function(e,t){n=e,r=t}),g.validateArgs("deleteShareIfExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=u(!0,{},n),o=this;o._doesShareExist(e,!0,s,function(t,n,a){t?r(t,n.exists,a):n.exists?o.deleteShare(e,s,function(e,t){var n;e?e&&e.statuscode===A.HttpResponseCodes.NotFound&&e.code===R.FileErrorCodeStrings.SHARE_NOT_FOUND&&(n=!1,e=null,t.isSuccessful=!0):n=!0,r(e,n,t)}):(a.isSuccessful=!0,r(t,!1,a))})},n.prototype.doesDirectoryExist=function(e,t,r,n){this._doesDirectoryExist(e,t,!1,r,n)},n.prototype.createDirectory=function(e,t,r,n){var o;h.normalizeArgs(r,n,function(e,t){o=e,n=t}),g.validateArgs("createDirectory",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var a=u(!0,{},o),i=y.put(s(e,t)).withQueryOption(T.RESTYPE,"directory");i.addOptionalMetadataHeaders(a.metadata);this.performRequest(i,null,a,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new F(t),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){n(e.error,e.directoryResult,e.response)})})},n.prototype.createDirectoryIfNotExists=function(e,t,r,n){var s;h.normalizeArgs(r,n,function(e,t){s=e,n=t}),g.validateArgs("createDirectoryIfNotExists",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=u(!0,{},s);delete o.shareSnapshotId;var a=this;a._doesDirectoryExist(e,t,!0,o,function(r,s,i){var l=s.exists;s.created=!1,delete s.exists,r?n(r,s,i):l?(i.isSuccessful=!0,n(r,s,i)):a.createDirectory(e,t,o,function(e,t,r){e?e&&e.statusCode===A.HttpResponseCodes.Conflict&&e.code===R.StorageErrorCodeStrings.RESOURCE_ALREADY_EXISTS&&(e=null,r.isSuccessful=!0):t.created=!0,n(e,t,r)})})},n.prototype.getDirectoryProperties=function(e,t,r,n){var o;h.normalizeArgs(r,n,function(e,t){o=e,n=t}),g.validateArgs("getDirectoryProperties",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var a=u(!0,{},o),i=y.head(s(e,t)).withQueryOption(T.RESTYPE,"directory").withQueryOption(T.SHARE_SNAPSHOT,a.shareSnapshotId),l=this;this.performRequest(i,null,a,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new F(t),e.directoryResult.metadata=l.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){n(e.error,e.directoryResult,e.response)})})},n.prototype.deleteDirectory=function(e,t,r,n){var o;h.normalizeArgs(r,n,function(e,t){o=e,n=t}),g.validateArgs("deleteDirectory",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var a=u(!0,{},o),i=y.del(s(e,t)).withQueryOption(T.RESTYPE,"directory");this.performRequest(i,null,a,function(e,t){t(e,function(e){n(e.error,e.response)})})},n.prototype.deleteDirectoryIfExists=function(e,t,r,n){var s;h.normalizeArgs(r,n,function(e,t){s=e,n=t}),g.validateArgs("deleteDirectoryIfExists",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=u(!0,{},s);delete o.shareSnapshotId;var a=this;a._doesDirectoryExist(e,t,!0,o,function(r,s,i){r?n(r,s.exists,i):s.exists?a.deleteDirectory(e,t,o,function(e,t){var r;e?e&&e.statuscode===A.HttpResponseCodes.NotFound&&e.code===R.StorageErrorCodeStrings.RESOURCE_NOT_FOUND&&(r=!1,e=null,t.isSuccessful=!0):r=!0,n(e,r,t)}):(i.isSuccessful=!0,n(r,!1,i))})},n.prototype.listFilesAndDirectoriesSegmented=function(e,t,r,n,s){this.listFilesAndDirectoriesSegmentedWithPrefix(e,t,null,r,n,s)},n.prototype.listFilesAndDirectoriesSegmentedWithPrefix=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("listFilesSegmented",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(a)});var c=u(!0,{},i),d=y.get(s(e,t)).withQueryOption(T.RESTYPE,"directory").withQueryOption(T.COMP,"list").withQueryOption(T.MAX_RESULTS,c.maxResults).withQueryOption(T.SHARE_SNAPSHOT,c.shareSnapshotId);h.objectIsNull(n)||d.withQueryOption(T.MARKER,n.nextMarker),d.withQueryOption(T.PREFIX,r);this.performRequest(d,null,c,function(e,t){if(e.listResult=null,!e.error){e.listResult={entries:null,continuationToken:null},e.listResult.entries={},e.listResult.entries.files=[],e.listResult.entries.directories=[];var r=[],n=[];e.response.body.EnumerationResults.Entries.File&&(r=e.response.body.EnumerationResults.Entries.File,l.isArray(r)||(r=[r])),r.forEach(function(t){var r=b.parse(t);e.listResult.entries.files.push(r)}),e.response.body.EnumerationResults.Entries.Directory&&(n=e.response.body.EnumerationResults.Entries.Directory,l.isArray(n)||(n=[n])),n.forEach(function(t){var r=F.parse(t);e.listResult.entries.directories.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listResult.continuationToken={nextMarker:null,targetLocation:null},e.listResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listResult.continuationToken.targetLocation=e.targetLocation)}t(e,function(e){a(e.error,e.listResult,e.response)})})},n.prototype.getDirectoryMetadata=function(e,t,r,n){var o;h.normalizeArgs(r,n,function(e,t){o=e,n=t}),g.validateArgs("getDirectoryMetadata",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var a=u(!0,{},o),i=s(e,t),l=y.head(i).withQueryOption(T.RESTYPE,"directory").withQueryOption(T.COMP,"metadata").withQueryOption(T.SHARE_SNAPSHOT,a.shareSnapshotId),c=this;this.performRequest(l,null,a,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new F(t),e.directoryResult.metadata=c.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){n(e.error,e.directoryResult,e.response)})})},n.prototype.setDirectoryMetadata=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("setDirectoryMetadata",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.shareNameIsValid(e),n.object(r,"metadata"),n.callback(o)});var i=u(!0,{},a),l=s(e,t),c=y.put(l).withQueryOption(T.RESTYPE,"directory").withQueryOption(T.COMP,"metadata");c.addOptionalMetadataHeaders(r);this.performRequest(c,null,i,function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new F(t),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){o(e.error,e.directoryResult,e.response)})})},n.prototype.generateSharedAccessSignature=function(e,t,r,n,o){if(!this.storageCredentials||!this.storageCredentials.generateSignedQueryString)throw new Error(f.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);g.validateArgs("generateSharedAccessSignature",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.object(n,"sharedAccessPolicy")});var a=E.ResourceTypes.SHARE;r?(g.validateArgs("generateSharedAccessSignature",function(e){e.stringAllowEmpty(t,"directory"),e.string(r,"file")}),a=E.ResourceTypes.FILE):t="",n.AccessPolicy&&(h.objectIsNull(n.AccessPolicy.Start)||(l.isDate(n.AccessPolicy.Start)||(n.AccessPolicy.Start=new Date(n.AccessPolicy.Start)),n.AccessPolicy.Start=h.truncatedISO8061Date(n.AccessPolicy.Start)),h.objectIsNull(n.AccessPolicy.Expiry)||(l.isDate(n.AccessPolicy.Expiry)||(n.AccessPolicy.Expiry=new Date(n.AccessPolicy.Expiry)),n.AccessPolicy.Expiry=h.truncatedISO8061Date(n.AccessPolicy.Expiry)));var i=s(e,t,r,!0);return this.storageCredentials.generateSignedQueryString(R.ServiceType.File,i,n,null,{headers:o,resourceType:a})},n.prototype.getUrl=function(e,t,r,n,i,l){g.validateArgs("getUrl",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e)});var u;u=h.objectIsNull(i)||!1!==i?this.host.primaryHost:this.host.secondaryHost,(u=h.trimPortFromUri(u))&&u.lastIndexOf("/")!==u.length-1&&(u+="/");var c=s(e,t,r),d=o.parse(n);return l&&(d[T.SHARE_SNAPSHOT]=l),a.resolve(u,a.format({pathname:this._getPath(c),query:d}))},n.prototype.getFileProperties=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("getFileProperties",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var i=u(!0,{},a),l=s(e,t,r),c=y.head(l).withQueryOption(T.SHARE_SNAPSHOT,i.shareSnapshotId),d=this;this.performRequest(c,null,i,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.metadata=d.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0));s(n,function(e){o(e.error,e.fileResult,e.response)})})},n.prototype.getFileMetadata=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("getFileMetadata",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var i=u(!0,{},a),l=s(e,t,r),c=y.head(l).withQueryOption(T.COMP,"metadata").withQueryOption(T.SHARE_SNAPSHOT,i.shareSnapshotId),d=this;this.performRequest(c,null,i,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.metadata=d.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){o(e.error,e.fileResult,e.response)})})},n.prototype.setFileProperties=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("setFileProperties",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var l=u(!0,{contentSettings:n,contentLength:n.contentLength},i),c=s(e,t,r),d=y.put(c).withQueryOption(T.COMP,"properties");b.setProperties(d,l);this.performRequest(d,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype.setFileMetadata=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("setFileMetadata",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.object(n,"metadata"),s.callback(a)});var l=u(!0,{},i),c=s(e,t,r),d=y.put(c).withQueryOption(T.COMP,"metadata");d.addOptionalMetadataHeaders(n);this.performRequest(d,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype.resizeFile=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("resizeFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.value(n),s.callback(a)});var l=u(!0,{},i),c=s(e,t,r),d=y.put(c).withQueryOption(T.COMP,"properties");d.withHeader(v.FILE_CONTENT_LENGTH,n);this.performRequest(d,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype.doesFileExist=function(e,t,r,n,s){this._doesFileExist(e,t,r,!1,n,s)},n.prototype.createFile=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("createFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.value(n),s.callback(a)});var l=s(e,t,r),c=u(!0,{},i),d=y.put(l).withHeader(v.TYPE,"file").withHeader(v.FILE_CONTENT_LENGTH,n);b.setProperties(d,c);this.performRequest(d,null,c,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype.deleteFile=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("deleteFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var i=u(!0,{},a),l=s(e,t,r),c=y.del(l);this.performRequest(c,null,i,function(e,t){t(e,function(e){o(e.error,e.response)})})},n.prototype.deleteFileIfExists=function(e,t,r,n,s){var o;h.normalizeArgs(n,s,function(e,t){o=e,s=t}),g.validateArgs("deleteFileIfExists",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var a=u(!0,{},o);delete a.shareSnapshotId;var i=this;i._doesFileExist(e,t,r,!0,a,function(n,o,l){n?s(n,o.exists,l):o.exists?i.deleteFile(e,t,r,a,function(e,t){var r;e?e&&e.statusCode===R.HttpConstants.HttpResponseCodes.NotFound&&e.code===R.FileErrorCodeStrings.FILE_NOT_FOUND&&(r=!1,e=null,t.isSuccessful=!0):r=!0,s(e,r,t)}):(l.isSuccessful=!0,s(n,!1,l))})},n.prototype.getFileToText=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("getFileToText",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var i=u(!0,{},a),l=s(e,t,r),c=y.get(l).withQueryOption(T.SHARE_SNAPSHOT,i.shareSnapshotId).withRawResponse();b.setHeaders(c,i),this._setRangeContentMD5Header(c,i);var d=this;this.performRequest(c,null,i,function(n,s){n.text=null,n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0),n.fileResult.metadata=d.parseMetadataHeaders(n.response.headers),n.text=n.response.body,d._validateLengthAndMD5(i,n));s(n,function(e){o(e.error,e.text,e.fileResult,e.response)})})},n.prototype.createReadStream=function(e,t,r,n,s){var o;h.normalizeArgs(n,s,function(e,t){o=e,s=t}),g.validateArgs("createReadStream",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e)});var a=u(!0,{},o),i=new _(a);return this.getFileToStream(e,t,r,i,a,function(e,t,r){e&&i.emit("error",e),s&&s(e,t,r)}),i},n.prototype.getFileToStream=function(e,t,r,n,s,o){var a;h.normalizeArgs(s,o,function(e,t){a=e,o=t}),a.speedSummary=a.speedSummary||new m(r),g.validateArgs("getFileToStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(o)});var i=u(!0,{},a),l={timeoutIntervalInMs:i.timeoutIntervalInMs,clientRequestTimeoutInMs:i.clientRequestTimeoutInMs,accessConditions:i.accessConditions,shareSnapshotId:i.shareSnapshotId};if(i.skipSizeCheck)this._getFileToStream(e,t,r,n,i,o);else{var c=this;this.getFileProperties(e,t,r,l,function(s,a){if(s)o(s);else{var l;if(i.rangeStart){var u=a.contentLength-1;l=(i.rangeEnd?Math.min(i.rangeEnd,u):u)-i.rangeStart+1}else l=a.contentLength;i.speedSummary.totalSize=l,l>c.singleFileThresholdInBytes?(h.setObjectInnerPropertyValue(i,["contentSettings","contentMD5"],h.tryGetValueChain(a,["contentSettings","contentMD5"],null)),c._getFileToRangeStream(e,t,r,n,i,o)):c._getFileToStream(e,t,r,n,i,o)}})}return i.speedSummary},n.prototype.listRanges=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("listRanges",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var i=s(e,t,r),c=u(!0,{},a),d=y.get(i).withQueryOption(T.COMP,"rangelist").withQueryOption(T.SHARE_SNAPSHOT,c.shareSnapshotId);b.setHeaders(d,c);this.performRequest(d,null,c,function(e,t){if(e.ranges=null,!e.error){e.ranges=[];var r=[];e.response.body.Ranges.Range&&(r=e.response.body.Ranges.Range,l.isArray(r)||(r=[r])),r.forEach(function(t){var r={start:parseInt(t.Start,10),end:parseInt(t.End,10)};e.ranges.push(r)})}t(e,function(e){o(e.error,e.ranges,e.response)})})},n.prototype.clearRange=function(e,t,r,n,s,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("clearRange",function(o){o.string(e,"share"),o.stringAllowEmpty(t,"directory"),o.string(r,"file"),o.shareNameIsValid(e),o.value(n),o.value(s),o.callback(a)});var l=u(!0,{},i),c=this._updateFilesImpl(e,t,r,n,s,E.RangeWriteOptions.CLEAR,l);this.performRequest(c,null,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype.createRangesFromStream=function(e,t,r,n,s,o,a,i){var l;h.normalizeArgs(a,i,function(e,t){l=e,i=t}),g.validateArgs("createRangesFromStream",function(a){a.string(e,"share"),a.stringAllowEmpty(t,"directory"),a.string(r,"file"),a.object(n,"readStream"),a.shareNameIsValid(e),a.value(s),a.value(o),a.callback(i)});var c=u(!0,{},l),d=h.objectIsNull(c.transactionalContentMD5)&&!0===c.useTransactionalMD5,p=o-s+1;if(p>E.MAX_UPDATE_FILE_SIZE)throw new Error(f.INVALID_FILE_RANGE_FOR_UPDATE);var m=this;d?h.calculateMD5(n,p,c,function(n,a){c.transactionalContentMD5=a,m._createRanges(e,t,r,n,null,s,o,c,i)}):m._createRanges(e,t,r,null,n,s,o,c,i)},n.prototype.createFileFromText=function(e,t,n,s,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("createFileFromText",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.string(n,"file"),r.exists(s,"text"),r.shareNameIsValid(e),r.callback(a)});var l=u(!0,{},i),c=r.isBuffer(s)?s.length:r.byteLength(s);if(c>E.MAX_UPDATE_FILE_SIZE)throw new Error(f.INVALID_FILE_LENGTH);l.storeFileContentMD5&&h.objectIsNull(h.tryGetValueChain(l,["contentSettings","contentMD5"],null))&&h.setObjectInnerPropertyValue(l,["contentSettings","contentMD5"],h.getContentMd5(s));var d=this;this.createFile(e,t,n,c,l,function(r){r?a(r):d._createRanges(e,t,n,s,null,0,c-1,l,a)})},n.prototype.createFileFromStream=function(e,t,r,n,s,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("createFileFromStream",function(o){o.string(e,"share"),o.stringAllowEmpty(t,"directory"),o.string(r,"file"),o.object(n,"stream"),o.value(s,"streamLength"),o.shareNameIsValid(e),o.callback(a)});var l=u(!0,{},i);l.speedSummary=l.speedSummary||new m(r),n.pause();var c=this;return this.createFile(e,t,r,s,l,function(o){if(o)a(o);else{var i=new w(n,{calcContentMd5:l.storeFileContentMD5});c._createFileFromChunkStream(e,t,r,i,s,l,a)}}),l.speedSummary},n.prototype.createWriteStreamToExistingFile=function(e,t,r,n,s){var o;h.normalizeArgs(n,s,function(e,t){o=e,s=t}),g.validateArgs("createWriteStreamToExistingFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e)});var a=u(!0,{},o),i=new _({calcContentMd5:a.storeFileContentMD5});return this._createFileFromChunkStream(e,t,r,i,null,a,function(e,t,r){e&&i.emit("error",e),s&&s(e,t,r)}),i},n.prototype.createWriteStreamToNewFile=function(e,t,r,n,s,o){var a;h.normalizeArgs(s,o,function(e,t){a=e,o=t}),g.validateArgs("createWriteStreamToNewFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.value(n,"length"),s.shareNameIsValid(e)});var i=u(!0,{},a),l=new _({calcContentMd5:i.storeFileContentMD5});l.pause();var c=this;return this.createFile(e,t,r,n,i,function(n){n?(l.emit("error",n),o(n)):(l.resume(),c._createFileFromChunkStream(e,t,r,l,null,i,function(e,t,r){e&&l.emit("error",e),o&&o(e,t,r)}))}),l},n.prototype.startCopyFile=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("startCopyFile",function(e){e.string(t,"targetShare"),e.stringAllowEmpty(r,"targetDirectory"),e.string(n,"targetFile"),e.shareNameIsValid(t),e.callback(a)});var l=s(t,r,n),c=u(!0,{},i),d=y.put(l).withHeader(v.COPY_SOURCE,e).addOptionalMetadataHeaders(c.metadata);this.performRequest(d,null,c,function(e,s){e.fileResult=null,e.error||(e.fileResult=new b(t,r,n),e.fileResult.getPropertiesFromHeaders(e.response.headers,!0),c.metadata&&(e.fileResult.metadata=c.metadata));s(e,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype.abortCopyFile=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("abortCopyFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var l=s(e,t,r),c=u(!0,{},i),d=y.put(l).withQueryOption(T.COPY_ID,n).withQueryOption(T.COMP,"copy").withHeader(v.COPY_ACTION,"abort");this.performRequest(d,null,c,function(e,t){t(e,function(e){a(e.error,e.response)})})},n.prototype._createRanges=function(e,t,r,n,s,o,a,i,l){var u=this._updateFilesImpl(e,t,r,o,a,E.RangeWriteOptions.UPDATE,i);!h.objectIsNull(n)&&h.objectIsNull(i.transactionalContentMD5)&&!0===i.useTransactionalMD5&&u.withHeader(v.CONTENT_MD5,h.getContentMd5(n));var c=function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){l(e.error,e.fileResult,e.response)})};h.objectIsNull(n)?this.performRequestOutputStream(u,s,i,c):this.performRequest(u,n,i,c)},n.prototype._createFileFromChunkStream=function(e,t,r,n,s,o,a){this.logger.debug(i.format("_createFileFromChunkStream for file %s",r));var l=E.DEFAULT_WRITE_SIZE_IN_BYTES,c=h.tryGetValueChain(o,["contentSettings","contentMD5"],null);this._setOperationExpiryTime(o);var d=o.speedSummary||new m;d.totalSize=s;var p=o.parallelOperationThreadCount||this.parallelOperationThreadCount,g=new N(l,p,{logger:this.logger});n._stream&&n._stream.setMemoryAllocator&&n._stream.setMemoryAllocator(g);var S=new I("_createRanges",{logger:this.logger,enableReuseSocket:this.defaultEnableReuseSocket});S.setConcurrency(p);var y={timeoutIntervalInMs:o.timeoutIntervalInMs,clientRequestTimeoutInMs:o.clientRequestTimeoutInMs,operationExpiryTime:o.operationExpiryTime},R=this;return n.on("data",function(s,a){var u=null,c=!1,p=d.getAutoIncrementFunction(s.length);if(s.length>l)throw new Error(i.format(f.EXCEEDED_SIZE_LIMITATION,l,s.length));if(o.useTransactionalMD5){var m=h.getContentMd5(s);y.transactionalContentMD5=m}h.isBufferAllZero(s)?(R.logger.debug(i.format("Skip upload data from %s bytes to %s bytes to file %s",a.start,a.end,r)),d.increment(s.length)):u=new I.RestOperation(R,"_createRanges",e,t,r,s,null,a.start,a.end,y,function(e){e?(R.logger.debug(i.format("Stop downloading data as error happens. Error: %s",i.inspect(e))),n.stop()):p(),g.releaseBuffer(s),s=null}),u&&(c=S.addOperation(u),u=null,c&&(R.logger.debug("file stream paused"),n.pause()))}),n.on("end",function(){R.logger.debug(i.format("File read stream ended for file %s",r)),S.enableComplete()}),S.on("drain",function(){R.logger.debug("File stream resume"),n.resume()}),S.on("end",function(s){if(R.logger.debug("batch operations commited"),s)a(s);else{c?o.contentSettings.contentMD5=c:o.storeFileContentMD5&&h.setObjectInnerPropertyValue(o,["contentSettings","contentMD5"],n.getContentMd5("base64"));var i=u(!1,o.contentSettings,{contentLength:o.streamLength});R.setFileProperties(e,t,r,i,function(e,t,r){n.finish(),a(e,t,r)})}}),d},n.prototype._getFileToStream=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("_getFileToStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(a)});var l=u(!0,{},i),c=s(e,t,r),d=y.get(c).withQueryOption(T.SHARE_SNAPSHOT,l.shareSnapshotId).withRawResponse();b.setHeaders(d,l),this._setRangeContentMD5Header(d,l);var p=this;this.performRequestInputStream(d,null,n,l,function(n,s){n.fileResult=null,n.error||(n.fileResult=new b(e,t,r),n.fileResult.metadata=p.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0),p._validateLengthAndMD5(l,n));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype._getFileToRangeStream=function(e,t,r,n,s,o){var a;h.normalizeArgs(s,o,function(e,t){a=e,o=t}),g.validateArgs("_getFileToRangeStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(o)});var l=a.speedSummary||new m(r),u=a.parallelOperationThreadCount||this.parallelOperationThreadCount,c=new I("getfile",{callbackInOrder:!0,logger:this.logger,enableReuseSocket:this.defaultEnableReuseSocket});c.setConcurrency(u);var d=new C(this,e,t,r,a),f=this,S=null;!a.disableContentMD5Validation&&(S=(new p).createMd5Hash());var y=null,R=null;d.on("range",function(s){l.totalSize||(l.totalSize=d.rangeSize);var o={rangeStart:s.start,rangeEnd:s.end,responseEncoding:null},u=s.size;if(o.shareSnapshotId=a.shareSnapshotId,o.timeoutIntervalInMs=a.timeoutIntervalInMs,o.clientRequestTimeoutInMs=a.clientRequestTimeoutInMs,o.useTransactionalMD5=a.useTransactionalMD5,0!==s.dataSize){if(!(s.start>s.end)){var p=new I.RestOperation(f,"getFileToText",e,t,r,o,function(e,t,r,s){if(e)f.logger.debug(i.format("Stop downloading data as error happens. Error: %s",i.inspect(e))),d.stop();else{u!==t.length&&f.logger.warn(i.format("Request %s bytes, but server returns %s bytes",u,t.length)),y||(y=r),R||(R=s);var o=l.getAutoIncrementFunction(t.length);n.write(t,o)||(f.logger.debug("Write stream is full and pause batch operation"),c.pause()),S&&S.update(t),t=null}});c.addOperation(p)&&(f.logger.debug("Pause range stream"),d.pause())}}else{var g=l.getAutoIncrementFunction(u),m=new I.CommonOperation(I.noOperation,function(e){if(!e){var t=h.writeZerosToStream(n,u,S,g);f.logger.debug(i.format("Write %s bytes Zero from %s to %s",u,s.start,s.end)),t||(f.logger.debug("Write stream is full and pause batch operation"),c.pause())}});c.addOperation(m)}}),d.on("end",function(){f.logger.debug("Range stream has ended."),c.enableComplete()}),c.on("drain",function(){f.logger.debug("Resume range stream"),d.resume()}),n.on("drain",function(){f.logger.debug("Resume batch operations"),c.resume()}),c.on("end",function(e){f.logger.debug("Download completed!"),e?o(e):n.end(function(){f.logger.debug("Write stream has ended"),n.close&&n.close(),y||(y={}),h.setObjectInnerPropertyValue(y,["contentSettings","contentMD5"],h.tryGetValueChain(a,["contentSettings","contentMD5"],null)),y.clientSideContentMD5=null,S&&(y.clientSideContentMD5=S.digest("base64")),o(e,y,R)})});var E={timeoutIntervalInMs:a.timeoutIntervalInMs,clientRequestTimeoutInMs:a.clientRequestTimeoutInMs};return d.list(E),l},n.prototype._setRangeContentMD5Header=function(e,t){if(!h.objectIsNull(t.rangeStart)&&t.useTransactionalMD5){if(h.objectIsNull(t.rangeEnd))throw new H(i.format(f.ARGUMENT_NULL_OR_EMPTY,t.rangeEndHeader));if(parseInt(t.rangeEnd,10)-parseInt(t.rangeStart,10)+1>E.MAX_RANGE_GET_SIZE_WITH_MD5)throw new Error(f.INVALID_RANGE_FOR_MD5);e.withHeader(v.RANGE_GET_CONTENT_MD5,"true")}},n.prototype._updateFilesImpl=function(e,t,r,n,o,a,i){var l=s(e,t,r),u=y.put(l).withQueryOption(T.COMP,"range").withHeader(v.CONTENT_TYPE,"application/octet-stream").withHeader(v.FILE_WRITE,a);if(i.rangeStart=n,i.rangeEnd=o,b.setHeaders(u,i),a===E.RangeWriteOptions.UPDATE){var c=o-n+1;u.withHeader(v.CONTENT_LENGTH,c)}else u.withHeader(v.CONTENT_LENGTH,0);return u},n.prototype._validateLengthAndMD5=function(e,t){var n,s=t.response.headers[R.HeaderConstants.CONTENT_MD5];h.objectIsNull(t.response.headers[R.HeaderConstants.CONTENT_LENGTH])||(n=parseInt(t.response.headers[R.HeaderConstants.CONTENT_LENGTH],10)),h.objectIsNull(e.disableContentMD5Validation)&&(e.disableContentMD5Validation=!1),!1===e.disableContentMD5Validation&&!0===e.useTransactionalMD5&&h.objectIsNull(s)&&(t.error=new Error(f.MD5_NOT_PRESENT_ERROR),t.retryable=!1),h.objectIsNull(t.length)&&("string"==typeof t.response.body?t.length=r.byteLength(t.response.body):r.isBuffer(t.response.body)&&(t.length=t.response.body.length)),h.objectIsNull(n)||t.length===n||(t.error=new Error(f.CONTENT_LENGTH_MISMATCH),t.retryable=!1),!1===e.disableContentMD5Validation&&h.objectIsNull(t.contentMD5)&&(t.contentMD5=h.getContentMd5(t.response.body)),!1!==e.disableContentMD5Validation||h.objectIsNull(s)||s===t.contentMD5||(t.error=new Error(i.format(f.HASH_MISMATCH,s,t.contentMD5)),t.retryable=!1)},n.prototype._doesFileExist=function(e,t,r,n,o,a){var i;h.normalizeArgs(o,a,function(e,t){i=e,a=t}),g.validateArgs("FileExists",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var l=u(!0,{},i),c=s(e,t,r),d=y.head(c).withQueryOption(T.SHARE_SNAPSHOT,l.shareSnapshotId);this.performRequest(d,null,l,function(n,s){n.fileResult=new b(e,t,r),n.error?n.error&&n.error.statusCode===R.HttpConstants.HttpResponseCodes.NotFound&&(n.error=null,n.fileResult.exists=!1,n.response.isSuccessful=!0):(n.fileResult.exists=!0,n.fileResult.getPropertiesFromHeaders(n.response.headers));s(n,function(e){a(e.error,e.fileResult,e.response)})})},n.prototype._doesDirectoryExist=function(e,t,r,n,o){var a;h.normalizeArgs(n,o,function(e,t){a=e,o=t}),g.validateArgs("directoryExists",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(o)});var i=u(!0,{},a),l=y.head(s(e,t)).withQueryOption(T.RESTYPE,"directory").withQueryOption(T.SHARE_SNAPSHOT,i.shareSnapshotId),c=this;this.performRequest(l,null,i,function(e,r){e.directoryResult=new F(t),e.directoryResult.exists=!1,e.error?e.error&&e.error.statusCode===R.HttpConstants.HttpResponseCodes.NotFound&&(e.error=null,e.response.isSuccessful=!0):(e.directoryResult.exists=!0,e.directoryResult.metadata=c.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));r(e,function(e){o(e.error,e.directoryResult,e.response)})})},n.prototype._doesShareExist=function(e,t,r,n){var s;h.normalizeArgs(r,n,function(e,t){s=e,n=t}),g.validateArgs("shareExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(n)});var o=u(!0,{},s),a=y.head(e).withQueryOption(T.RESTYPE,"share").withQueryOption(T.SHARE_SNAPSHOT,o.shareSnapshotId);this.performRequest(a,null,o,function(t,r){t.shareResult=new O(e),t.shareResult.exists=!1,t.error?t.error&&t.error.statusCode===R.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.response.isSuccessful=!0):(t.shareResult.exists=!0,t.shareResult.getPropertiesFromHeaders(t.response.headers));r(t,function(e){n(e.error,e.shareResult,e.response)})})},n.SpeedSummary=m,t.exports=n}).call(this,e("buffer").Buffer)},{"../../common/errors/errors":8,"./../../common/common.core":6,"./../../common/md5-wrapper":13,"./internal/filerangestream":53,"./models/directoryresult":54,"./models/fileresult":55,"./models/shareresult":56,buffer:"buffer",extend:157,path:190,querystring:207,underscore:247,url:248,util:"util"}],190:[function(e,t,r){(function(e){function t(e,t){for(var r=0,n=e.length-1;n>=0;n--){var s=e[n];"."===s?e.splice(n,1):".."===s?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return s.exec(e).slice(1)};r.resolve=function(){for(var r="",s=!1,o=arguments.length-1;o>=-1&&!s;o--){var a=o>=0?arguments[o]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(r=a+"/"+r,s="/"===a.charAt(0))}return r=t(n(r.split("/"),function(e){return!!e}),!s).join("/"),(s?"/":"")+r||"."},r.normalize=function(e){var s=r.isAbsolute(e),o="/"===a(e,-1);return(e=t(n(e.split("/"),function(e){return!!e}),!s).join("/"))||s||(e="."),e&&o&&(e+="/"),(s?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(n(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var s=n(e.split("/")),o=n(t.split("/")),a=Math.min(s.length,o.length),i=a,l=0;l<a;l++)if(s[l]!==o[l]){i=l;break}for(var u=[],l=i;l<s.length;l++)u.push("..");return(u=u.concat(o.slice(i))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var t=o(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},r.basename=function(e,t){var r=o(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},r.extname=function(e){return o(e)[3]};var a="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,e("_process"))},{_process:197}],56:[function(e,t,r){function n(e){this.name=e}var s=e("./../../../common/common.core"),o=s.util,a=s.Constants.HeaderConstants;n.parse=function(e,t){var r=new n(t);for(var s in e)if(e.hasOwnProperty(s))if("Properties"===s)o.setPropertyValueFromXML(r,e[s],!0);else if("Metadata"===s||"ShareStats"===s){var a=o.normalizePropertyNameFromXML(s);r[a]={},o.setPropertyValueFromXML(r[a],e[s],"ShareStats"===s)}else r[s.toLowerCase()]=e[s];return r},n.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,n){!t[r]&&e[n.toLowerCase()]&&(t[r]=e[n.toLowerCase()])};r("etag",a.ETAG),r("lastModified",a.LAST_MODIFIED),r("requestId",a.REQUEST_ID),r("quota",a.SHARE_QUOTA)},t.exports=n},{"./../../../common/common.core":6}],55:[function(e,t,r){function n(e,t,r){this.share=e,this.directory=t,this.name=r}var s=e("underscore"),o=e("./../../../common/common.core"),a=o.util,i=o.Constants.HeaderConstants;n.parse=function(e){var t=new n;for(var r in e)"Properties"===r?a.setPropertyValueFromXML(t,e[r],!0):t[r.toLowerCase()]=e[r];return t};var l={acceptRanges:"ACCEPT_RANGES",contentLength:"CONTENT_LENGTH",contentRange:"CONTENT_RANGE","contentSettings.contentType":"CONTENT_TYPE","contentSettings.contentEncoding":"CONTENT_ENCODING","contentSettings.contentLanguage":"CONTENT_LANGUAGE","contentSettings.cacheControl":"CACHE_CONTROL","contentSettings.contentDisposition":"CONTENT_DISPOSITION","contentSettings.contentMD5":"CONTENT_MD5","contentSettings.fileContentMD5":"FILE_CONTENT_MD5","copy.id":"COPY_ID","copy.status":"COPY_STATUS","copy.source":"COPY_SOURCE","copy.progress":"COPY_PROGRESS","copy.completionTime":"COPY_COMPLETION_TIME","copy.statusDescription":"COPY_STATUS_DESCRIPTION"};n.prototype.getPropertiesFromHeaders=function(e,t){var r=this,n=function(t,n){if(!a.tryGetValueChain(r,t.split("."),null)&&e[n.toLowerCase()]&&(a.setObjectInnerPropertyValue(r,t.split("."),e[n.toLowerCase()]),"copy.progress"===t)){var s=a.parseCopyProgress(r.copy.progress);r.copy.bytesCopied=parseInt(s.bytesCopied),r.copy.totalBytes=parseInt(s.totalBytes)}};n("contentSettings.contentMD5",i.FILE_CONTENT_MD5),n("etag",i.ETAG),n("lastModified",i.LAST_MODIFIED),n("requestId",i.REQUEST_ID),n("serverEncrypted",i.SERVER_ENCRYPTED),t&&s.chain(l).pairs().each(function(e){var t=e[0],r=i[e[1]];n(t,r)})},n.setHeaders=function(e,t){var r=function(r,n){var s=a.tryGetValueChain(t,n.split("."),null);s&&e.withHeader(r,s)};if(t&&(r(i.CONTENT_MD5,"transactionalContentMD5"),r(i.CONTENT_LENGTH,"contentLength"),!a.objectIsNull(t.rangeStart))){var n="bytes="+t.rangeStart+"-";a.objectIsNull(t.rangeEnd)||(n+=t.rangeEnd),e.withHeader(i.STORAGE_RANGE,n)}},n.setProperties=function(e,t){var r=function(r,n){var s=a.tryGetValueChain(t,n.split("."),null);s&&e.withHeader(r,s)};t&&(r(i.FILE_CONTENT_LENGTH,"contentLength"),r(i.FILE_CONTENT_TYPE,"contentSettings.contentType"),r(i.FILE_CONTENT_ENCODING,"contentSettings.contentEncoding"),r(i.FILE_CONTENT_LANGUAGE,"contentSettings.contentLanguage"),r(i.FILE_CONTENT_DISPOSITION,"contentSettings.contentDisposition"),r(i.FILE_CACHE_CONTROL,"contentSettings.cacheControl"),r(i.FILE_CONTENT_MD5,"contentSettings.contentMD5"),t.metadata&&e.addOptionalMetadataHeaders(t.metadata))},t.exports=n},{"./../../../common/common.core":6,underscore:247}],54:[function(e,t,r){function n(e){this.name=e}var s=e("./../../../common/common.core").Constants.HeaderConstants;n.parse=function(e){return new n(e.Name)},n.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,n){!t[r]&&e[n.toLowerCase()]&&(t[r]=e[n.toLowerCase()])};r("etag",s.ETAG),r("lastModified",s.LAST_MODIFIED),r("requestId",s.REQUEST_ID),r("serverEncrypted",s.SERVER_ENCRYPTED)},t.exports=n},{"./../../../common/common.core":6}],53:[function(e,t,r){function n(e,t,r,s,o){n.super_.call(this,e,null,null,o),this._lengthHeader=a.HeaderConstants.FILE_CONTENT_LENGTH,o.minRangeSize?this._minRangeSize=o.minRangeSize:this._minRangeSize=a.FileConstants.MIN_WRITE_FILE_SIZE_IN_BYTES,o.maxRangeSize?this._maxRangeSize=o.maxRangeSize:this._maxRangeSize=a.FileConstants.DEFAULT_WRITE_SIZE_IN_BYTES,this._listFunc=e.listRanges,this._resourcePath.push(t),this._resourcePath.push(r),this._resourcePath.push(s)}var s=e("util"),o=e("./../../../common/streams/rangestream"),a=e("./../../../common/util/constants");s.inherits(n,o),t.exports=n},{"./../../../common/streams/rangestream":30,"./../../../common/util/constants":33,util:"util"}]},{},[2]);
